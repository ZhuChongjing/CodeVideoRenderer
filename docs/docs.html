<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文档 - CodeVideoRenderer</title>
    <!-- 样式表引用 -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    
    <!-- 脚本引用 -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
</head>
<body> 
    
    <div class="bg-glow"></div>

    <!-- Header -->
    <header>
        <div class="container">
            <a href="index.html" style="text-decoration: none;">
                <h1 class="logo">
                    <i class="fas fa-code text-accent"></i> 
                    <code>CodeVideoRenderer</code>
                </h1>
            </a>
            <nav>
                <!-- 1. GitHub -->
                <a href="https://github.com/ZhuChongjing/CodeVideoRenderer" target="_blank" title="GitHub">
                    <i class="fab fa-github"></i>
                </a>
                <!-- 2. Email (保留不删) -->
                <a href="mailto:zhuchongjing_pypi@163.com" target="_blank" title="Email">
                    <i class="fas fa-envelope"></i>
                </a>
                <!-- 3. Home (替换原来的文档图标) -->
                <a href="index.html" title="返回首页">
                    <i class="fas fa-home"></i>
                </a>
            </nav>
        </div>
    </header>

    <div class="container docs-layout">
        <!-- 左侧侧边栏导航 -->
        <aside class="docs-sidebar">
            <nav class="sidebar-nav">
                <div class="nav-group">
                    <span class="nav-title">开始</span>
                    <a href="#intro" class="nav-link active">简介</a>
                    <a href="#install" class="nav-link">安装依赖</a>
                    <a href="#quickstart" class="nav-link">快速上手</a>
                </div>
                <div class="nav-group">
                    <span class="nav-title">核心类</span>
                    <a href="#CameraFollowCursorCV" class="nav-link">CameraFollowCursorCV</a>
                    <a href="#init-params" class="nav-link">初始化参数</a>
                    <a href="#render-method" class="nav-link">渲染方法</a>
                </div>
                <div class="nav-group">
                    <span class="nav-title">进阶</span>
                    <a href="#input-logic" class="nav-link">输入源处理</a>
                    <a href="#algo" class="nav-link">相机算法</a>
                </div>
            </nav>
        </aside>

        <!-- 右侧主内容 -->
        <main class="docs-content">
            
            <!-- 简介 -->
            <section id="intro">
                <h1>简介</h1>
                <p><code>CameraFollowCursorCV</code> 是本库的核心类，专门设计用于模拟代码输入的动画过程。它通过逐行、逐字符的动画效果，配合平滑的摄像机跟随，创造出具有专业水准的代码演示视频。</p>
                <div class="tip-box">
                    <i class="fas fa-star"></i>
                    <span><strong>特性：</strong> 支持基于 <code>rich</code> 的终端进度条、动态缩放算法、以及随机打字间隔模拟。</span>
                </div>
            </section>

            <!-- 安装 -->
            <section id="install">
                <h2>安装依赖</h2>
                <p>本库依赖于 <code>manim</code> 和 <code>rich</code>。确保您的环境中已安装 <a href="https://www.python.org/downloads/" target="_blank" class="code">Python 3.9+</a> 以及 <a href="https://ffmpeg.org/download.html" target="_blank" class="code">FFmpeg</a>。</p>
                <div class="code-block-wrapper">
                    <pre><code class="bash">pip install CodeVideoRenderer</code></pre>
                    <button class="copy-btn" onclick="navigator.clipboard.writeText('pip install CodeVideoRenderer');alert('Copied!')"><i class="far fa-copy"></i></button>
                </div>
            </section>

            <!-- 快速开始 -->
            <section id="quickstart">
                <h2>快速上手</h2>
                <p>以下代码展示了如何生成一个最简单的视频：</p>
                
                <div class="code-block-wrapper">
                    <pre><code class="python">from CodeVideoRenderer import CameraFollowCursorCV
video = CameraFollowCursorCV(
    video_name="Demo",                    # 文件名
    code_string="print('Hello World!')",  # 代码
    language="python"                     # 语言
)
video.render()</code></pre>
                    <button class="copy-btn" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText);alert('Code Copied!')"><i class="far fa-copy"></i></button>
                </div>
                <p>渲染结束后，您将在终端看到 <code>Demo.mp4</code> 文件的保存路径。</p>
            </section>

            <!-- 类定义 -->
            <section id="CameraFollowCursorCV">
                <h2><code>CameraFollowCursorCV</code> 类</h2>
                <p>该类继承并封装了 $\mathbb{M}\text{anim}$ 的场景逻辑，自动处理光标移动、换行、缩进以及摄像机的运动轨迹。</p>
                <div class="code-block-wrapper">
                    <pre><code class="python">class CameraFollowCursorCV(
    video_name: str = "CameraFollowCursorCV",
    code_string: str = None,
    code_file: str = None,
    language: str = None,
    line_spacing: float | int = DEFAULT_LINE_SPACING,
    interval_range: tuple[float | int, float | int] = (DEFAULT_TYPE_INTERVAL, DEFAULT_TYPE_INTERVAL),
    camera_scale: float | int = 0.5
)</code></pre>
                </div>
            </section>

            <!-- 初始化参数 -->
            <section id="init-params">
                <h3>初始化参数 <code>__init__</code></h3>
                <p>在创建实例时，您可以配置以下参数来控制视频的生成细节：</p>

                <table class="docs-table">
                    <thead>
                        <tr>
                            <th style="width: 20%">参数名</th>
                            <th style="width: 20%">类型</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>video_name</code></td>
                            <td><code>str</code></td>
                            <td>输出视频的文件名（无需后缀）。</td>
                        </tr>
                        <tr>
                            <td><code>code_string</code></td>
                            <td><code>str</code></td>
                            <td>直接传入的代码字符串。</td>
                        </tr>
                        <tr>
                            <td><code>code_file</code></td>
                            <td><code>str</code></td>
                            <td>代码文件的路径。支持读取本地文件内容。</td>
                        </tr>
                        <tr>
                            <td><code>language</code></td>
                            <td><code>str</code></td>
                            <td>用于语法高亮的语言名称（如 <code>"python"</code>、<code>"c++"</code>等）。</td>
                        </tr>
                        <tr>
                            <td><code>line_spacing</code></td>
                            <td><code>float | int</code></td>
                            <td>行间距。默认值基于配置常量，必须大于 0。</td>
                        </tr>
                        <tr>
                            <td><code>interval_range</code></td>
                            <td><code>tuple</code></td>
                            <td>打字间隔范围 <code>(min, max)</code>。单位为秒。</td>
                        </tr>
                        <tr>
                            <td><code>camera_scale</code></td>
                            <td><code>float | int</code></td>
                            <td>相机的初始缩放比例。默认为 <code>0.5</code>。</td>
                        </tr>
                    </tbody>
                </table>

                <div class="tip-box">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span><strong>注意：</strong> <code>code_string</code> 和 <code>code_file</code> 只能二选一，否则会抛出 <code>ValueError</code>。</span>
                </div>
            </section>

            <!-- 渲染方法 -->
            <section id="render-method">
                <h3>渲染方法 <code>render()</code></h3>
                <div class="code-block-wrapper">
                    <pre><code class="python">def render(self, output: bool = True) -> None:</code></pre>
                </div>
                <p>启动 $\mathbb{M}\text{anim}$ 渲染流程。渲染过程中会在控制台通过 <code>rich</code> 库显示详细的进度条、当前行号以及预计剩余时间。</p>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th style="width: 20%">参数名</th>
                            <th style="width: 20%">类型</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>output</code></td>
                            <td><code>bool</code></td>
                            <td>是否在控制台输出日志信息。默认为 <code>True</code>。</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- 输入处理逻辑 -->
            <section id="input-logic">
                <h2>输入源处理逻辑</h2>
                <p>库内部会对输入的代码进行严格的预处理，以保证渲染稳定性：</p>
                <ol>
                    <li><strong>Tab 转换</strong>: 所有的制表符 <code>\t</code> 会被自动展开为空格（默认宽度 4）。</li>
                    <li><strong>字符校验</strong>: 自动检测代码中是否包含 $\mathbb{M}\text{anim}$ 无法渲染的非法字符或非 ASCII 字符（当使用默认字体时）。</li>
                    <li><strong>空行处理</strong>: 代码首尾的空行会被自动剔除，但保留段落间的空行以维持格式。</li>
                </ol>
            </section>

            <!-- 算法 -->
            <section id="algo">
                <h2>动态相机算法</h2>
                <p>为了确保长代码行也能完整显示，<code>CameraFollowCursorCV</code> 实现了一套自适应缩放算法。系统每渲染一个字符，都会判断是否需要拉远镜头。</p>
                
                <h3>核心公式</h3>
                <div class="math-block">
                    $$ D = \frac{X_\text{cam} - X_\text{origin}}{12} $$
                </div>
                
                <h3>变量含义</h3>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th>变量符号</th>
                            <th>代码对应</th>
                            <th>含义解析</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>$D$</td>
                            <td><code>distance</code></td>
                            <td><strong>目标缩放系数</strong>。表示为了完整显示当前代码行宽度，相机所需的最小缩放比例。</td>
                        </tr>
                        <tr>
                            <td>$X_\text{cam}$</td>
                            <td><code>camera.frame.get_x()</code></td>
                            <td><strong>相机中心横坐标</strong>。在跟随模式下，这通常等于当前<strong>光标</strong>的中心横坐标。</td>
                        </tr>
                        <tr>
                            <td>$X_\text{origin}$</td>
                            <td><code>line_number.get_x()</code></td>
                            <td><strong>原点</strong>。这里使用<strong>行号对象</strong>的横坐标作为参考原点。</td>
                        </tr>
                    </tbody>
                </table>

                <h3>判断逻辑</h3>
                <p>如果计算出的目标系数 $D$ 大于当前的相机缩放，则触发 <code>scale</code> 动画，将相机平滑拉远，确保光标始终处于视口右侧的安全区域内。</p>
                <div class="code-block-wrapper">
                    <pre><code class="python">def JUDGE_cameraScaleAnimation():
    distance = (scene.camera.frame.get_x() - line_number_mobject.get_x()) / 12
    if distance > self.camera_scale:
        scene.Animation_list.append({"scale": distance/self.camera_scale})
        self.camera_scale = distance</code></pre>
                </div>
            </section>

        </main>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <p class="copyright">Copyright © 2025 ZhuChongjing. All rights reserved. Released under MIT License.</p>
        </div>
    </footer>

    <!-- 脚本初始化 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="script.js"></script>
</body>
</html>